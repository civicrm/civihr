define("contact-summary/modules/filters",["common/angular"],function(e){"use strict";return e.module("contactsummary.filters",[])}),define("contact-summary/modules/services",["common/angular"],function(e){"use strict";return e.module("contactsummary.services",[])}),define("contact-summary/modules/settings",["common/angular"],function(e){"use strict";return e.module("contactsummary.settings",[]).constant("settings",{classNamePrefix:"contactSummary-",contactId:decodeURIComponent((new RegExp("[?|&]cid=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null,debug:!0,pathApp:"",pathRest:CRM.url("civicrm/ajax/rest"),pathBaseUrl:CRM.vars.contactsummary.baseURL+"/",pathTpl:"views/"})}),define("contact-summary/modules/controllers",["common/angular"],function(e){"use strict";return e.module("contactsummary.controllers",[])}),define("contact-summary/controllers/contactSummary",["contact-summary/modules/controllers","contact-summary/modules/settings"],function(e){"use strict";function t(e,t){e.debug("Controller: ContactSummaryCtrl");var n=t.pathBaseUrl+t.pathTpl;this.partials={keyDetails:n+"/include/keyDetails.html",keyDates:n+"/include/keyDates.html"},this.ready=!1}e.controller("ContactSummaryCtrl",["$log","settings",t])}),define("contact-summary/services/api",["contact-summary/modules/services"],function(e){"use strict";e.factory("ApiService",["$http","$q",function(e,t){function n(e,t,n,r){if(!angular.isDefined(e))throw new Error("Entity name not provided");if(!angular.isDefined(n))throw new Error("Action not provided");return t=angular.extend({entity:e,action:n,sequential:1,json:1,rowCount:0},t),r?jQuery.param(t):t}function r(n,r,s){return s=angular.extend({method:n,url:"/civicrm/ajax/rest"},"post"===n?{data:r}:{params:r},s),e(s).then(function(e){return e.is_error?t.reject(e):e.data}).catch(function(e){return e})}return{get:function(e,t,s){return r("get",n(e,t,"get"),s)},post:function(e,t,s,a){return a=angular.extend({headers:{"Content-Type":"application/x-www-form-urlencoded"}},a),r("post",n(e,t,s,!0),a)},getValue:function(e,t){},create:function(e,t){},update:function(e,t){},delete:function(e,t){}}}])}),define("contact-summary/services/item",["common/moment","contact-summary/modules/services"],function(e,t){"use strict";function n(){var e={};return e.createInstance=function(){var e=Object.create(this);return e.item={},e},e.get=function(){return this.item},e.set=function(e){if(!angular.isObject(e))throw new TypeError("Data must be of type Object");this.item=e},e.setKey=function(e,t){this.item[e]=t},e}t.factory("ItemService",n)}),define("contact-summary/services/model",["contact-summary/modules/services","contact-summary/services/item"],function(e){"use strict";function t(e){var t={};return t.data={},t.createInstance=function(){var t=Object.create(this);return t.data=e.createInstance(),t},t.getData=function(){return this.data.get()},t.setData=function(e){this.data.set(e)},t.setDataKey=function(e,t){this.data.setKey(e,t)},t}e.factory("ModelService",["ItemService",t])}),define("contact-summary/services/contactDetails",["common/lodash","common/moment","contact-summary/modules/services","contact-summary/modules/settings","contact-summary/services/api","contact-summary/services/model"],function(e,t,n){"use strict";function r(n,r,s,a,c){function o(){var r=n.defer();if(e.isEmpty(u.getData())){var a=c.contactId;s.get("Contact",{contact_id:a,return:"birth_date"}).then(function(e){if(0===e.values.length)throw new Error("Contact with ID "+a+" not found");var n=e.values[0].birth_date,s=t(n,"YYYY-MM-DD").isValid()?i(n):"";u.setDataKey("id",a),u.setDataKey("dateOfBirth",n),u.setDataKey("age",s),r.resolve()}).catch(function(e){r.reject(e)})}else r.resolve();return r.promise}function i(e){return t().diff(t(e,"YYYY-MM-DD"),"years")}r.debug("Service: ContactDetailsService");var u=a.createInstance();return u.get=function(){var e=this,t=n.defer();return o().then(function(){t.resolve(e.getData())}),t.promise},u}n.factory("ContactDetailsService",["$q","$log","ApiService","ModelService","settings",r])}),define("contact-summary/services/contract",["common/lodash","contact-summary/modules/services","contact-summary/services/api","contact-summary/services/contactDetails","contact-summary/services/model"],function(e,t){"use strict";function n(t,n,s,a,c){function o(){l.collection={items:{},insertItem:function(e,t){this.items[e]=t},getItem:function(e){return this.items[e]},set:function(e){this.items=e},get:function(){return this.items}}}function i(){var n=t.defer();return e.isEmpty(l.collection.get())?l.getContracts().then(u).finally(function(){n.resolve()}):n.resolve(),n.promise}function u(){var e=t.defer(),r=[];return angular.forEach(m,function(e){var t={};t.id=e.id,t.is_primary=e.is_primary,t.is_current=e.is_current,t.revision_id=null,e.api_HRJobContractRevision_getcurrentrevision&&(t.revision_id=e.api_HRJobContractRevision_getcurrentrevision.values.id);var n=l.getContractDetails(e.id).then(function(e){t.title=e.title,t.start_date=e.period_start_date,t.end_date=e.period_end_date,t.type=e.contract_type,t.pay=e.pay,t.hours=e.hours}).then(function(){l.collection.insertItem(e.id,t)});r.push(n)}),t.all(r).catch(function(e){n.error("Something went wrong",e)}).finally(function(){e.resolve()}),e.promise}n.debug("Service: Contract Service");var l={};o(),l.getCollection=function(){return this.collection.get()},l.get=function(){var e=this;return i().then(function(){return e.getCollection()})},l.getPrimary=function(){return this.get().then(function(t){var n=e.sortBy(t,function(e){return[e.end_date,+e.is_primary]});return e.last(n)||{}})},l.resetContracts=function(){m=[],r={},o()},l.getContracts=function(){var n=t.defer();return e.isEmpty(m)?c.get().then(function(e){var t={contact_id:e.id,"api.HRJobContractRevision.getcurrentrevision":{jobcontract_id:"$value.id"}};return s.get("HRJobContract",t)}).then(function(e){var t=e.values.filter(function(e){return 0===parseInt(e.deleted)});return 0===t.length?n.reject("No job contract found"):(m=t,void n.resolve(m))}).catch(function(e){n.reject(e)}):n.resolve(m),n.promise},l.getContractDetails=function(e){var n=function(e){var t={};0!==e.api_HRJobPay_get.values.length&&(t.amount=e.api_HRJobPay_get.values[0].pay_amount,t.currency=e.api_HRJobPay_get.values[0].pay_currency),e.pay=t},a=function(e){var t={};0!==e.api_HRJobHour_get.values.length&&(t.amount=e.api_HRJobHour_get.values[0].hours_amount,t.unit=e.api_HRJobHour_get.values[0].hours_unit),e.hours=t},c={jobcontract_id:e,"api.HRJobPay.get":{jobcontract_id:e},"api.HRJobHour.get":{jobcontract_id:e}};return r.getContractDetails||(r.getContractDetails=s.post("HRJobDetails",c,"get").then(function(r){if(0===r.values.length)return t.reject("No details found for contract revision with ID "+e);var s=r.values[0];return n(s),a(s),s})),r.getContractDetails},l.getLengthOfService=function(){var e=t.defer();return c.get().then(function(e){return s.post("HRJobContract",{sequential:0,contact_id:e.id},"getlengthofserviceymd")}).then(function(t){t.is_error?e.reject(t):e.resolve(t.values)}).catch(function(t){e.reject(t)}),e.promise};var m=[];return l}var r={};t.factory("ContractService",["$q","$log","ApiService","ModelService","ContactDetailsService",n])}),define("contact-summary/services/jobRole",["common/lodash","contact-summary/modules/services","contact-summary/services/api","contact-summary/services/contract","contact-summary/services/model"],function(e,t){"use strict";function n(t,n,r,s,a){function c(){var n=t.defer();return e.isEmpty(o.collection.get())?a.get().then(function(e){var s=[];return angular.forEach(e,function(e){s.push(e.id)}),0===s.length?t.reject("No job roles found for contracts"):void r.post("HrJobRoles",{job_contract_id:{IN:s}},"get").then(function(e){if(0===e.values.length)return t.reject("No job roles found for contracts");var n=e.values.map(function(e){return{id:e.id,title:e.title,department:e.department,status:e.status,start_date:e.start_date,end_date:e.end_date}});o.collection.set(n)}).finally(function(){n.resolve()})}):n.resolve(),n.promise}n.debug("Service: JobRoleService");var o={};return o.collection={items:{},insertItem:function(e,t){this.items[e]=t},getItem:function(e){return this.items[e]},set:function(e){this.items=e},get:function(){return this.items}},o.getCollection=function(){return this.collection.get()},o.get=function(){var e=this;return c().then(function(){return e.getCollection()})},o}t.factory("JobRoleService",["$q","$log","ApiService","ModelService","ContractService",n])}),define("contact-summary/controllers/keyDates",["common/moment","contact-summary/modules/controllers","contact-summary/services/contract","contact-summary/services/jobRole","common/services/pub-sub"],function(e,t){"use strict";function n(e){this.dates.push({title:e.title+" (Start)",date:e.start_date,future:r(e.start_date)}),e.end_date&&this.dates.push({title:e.title+" (End)",date:e.end_date,future:r(e.end_date)})}function r(t){return e().diff(t)<0}function s(t,s,a,c){t.debug("Controller: KeyDatesCtrl");var o=this;this.ready=!1,this.dates=[],this.activeContracts=0,this.activeRoles=0;var i=function(){s.get().then(function(e){return angular.forEach(e,function(e){n.call(o,e),"1"===e.is_current&&o.activeContracts++}),a.get()}).then(function(t){angular.forEach(t,function(t){var n=e(t.end_date);n.isValid()&&!r(n)||o.activeRoles++})}).finally(function(){o.ready=!0})}.bind(this),u=function(){this.dates=[],i()}.bind(this);i(),c.subscribe("contract-refresh",u)}t.controller("KeyDatesCtrl",["$log","ContractService","JobRoleService","pubSub",s])}),define("contact-summary/controllers/keyDetails",["common/moment","contact-summary/modules/controllers","contact-summary/services/contactDetails","contact-summary/services/contract","common/services/pub-sub"],function(e,t){"use strict";function n(e,t,n,r){e.debug("Controller: KeyDetailsCtrl"),this.ready=!1;var s=function(){t.get().then(function(e){return this.contactDetails=e,n.getPrimary()}.bind(this)).then(function(e){return _.isEmpty(e)?void(this.primaryContract=null):void(this.primaryContract=e)}.bind(this)).then(function(e){return n.getLengthOfService()}).then(function(e){this.lengthOfService=e}.bind(this)).finally(function(){this.ready=!0}.bind(this))}.bind(this),a=function(){n.resetContracts(),t.data.item={},s()};s(),r.subscribe("contract-refresh",a)}t.controller("KeyDetailsCtrl",["$log","ContactDetailsService","ContractService","pubSub",n])}),function(e){define("leave-absences/shared/modules/shared-settings",["common/angular"],function(t){return t.module("leave-absences.settings",[]).constant("shared-settings",{attachmentToken:e.vars.leaveAndAbsences.attachmentToken,debug:e.debug,managerPathTpl:e.vars.leaveAndAbsences.baseURL+"/views/manager-leave/",sharedPathTpl:e.vars.leaveAndAbsences.baseURL+"/views/shared/",serverDateFormat:"YYYY-MM-DD",serverDateTimeFormat:"YYYY-MM-DD HH:mm:ss",permissions:{admin:{access:"access leave and absences",administer:"administer leave and absences"},ssp:{access:"access leave and absences in ssp",manage:"manage leave and absences in ssp"}},fileUploader:{queueLimit:10},statusNames:{approved:"approved",adminApproved:"admin_approved",awaitingApproval:"awaiting_approval",moreInformationRequired:"more_information_required",rejected:"rejected",cancelled:"cancelled"}})})}(CRM),define("leave-absences/shared/modules/apis",["common/angular","common/modules/apis","leave-absences/shared/modules/shared-settings"],function(e){"use strict";return e.module("leave-absences.apis",["common.apis","leave-absences.settings"])}),define("leave-absences/shared/modules/models-instances",["common/angular","common/models/instances/instance","common/modules/services","common/modules/models","common/services/check-permissions","leave-absences/shared/modules/shared-settings"],function(e){"use strict";return e.module("leave-absences.models.instances",["common.models","common.models.instances","common.services","leave-absences.settings"])}),define("leave-absences/shared/modules/models",["common/angular","common/modules/models","common/modules/services","leave-absences/shared/modules/apis","leave-absences/shared/modules/models-instances","leave-absences/shared/modules/shared-settings"],function(e){"use strict";return e.module("leave-absences.models",["common.models","common.services","leave-absences.apis","leave-absences.models.instances","leave-absences.settings"])}),define("leave-absences/shared/apis/absence-type.api",["common/lodash","common/moment","leave-absences/shared/modules/apis","common/services/api"],function(e,t,n){"use strict";n.factory("AbsenceTypeAPI",["$log","api","shared-settings",function(n,r,s){return n.debug("AbsenceTypeAPI"),r.extend({all:function(t){return n.debug("AbsenceTypeAPI.all"),this.sendGET("AbsenceType","get",e.defaults(t||{},{is_active:!0})).then(function(e){return e.values})},calculateToilExpiryDate:function(r,a,c){return n.debug("AbsenceTypeAPI.calculateToilExpiryDate"),c=e.assign({},c,{absence_type_id:r,date:t(a).format(s.serverDateFormat)}),this.sendPOST("AbsenceType","calculateToilExpiryDate",c).then(function(e){return e.values.expiry_date})}})}])}),define("leave-absences/shared/instances/absence-type.instance",["leave-absences/shared/modules/models-instances","common/models/instances/instance"],function(e){"use strict";e.factory("AbsenceTypeInstance",["$log","ModelInstance",function(e,t){return e.debug("AbsenceTypeInstance"),t.extend({})}])}),define("leave-absences/shared/models/absence-type.model",["leave-absences/shared/modules/models","common/models/model","leave-absences/shared/apis/absence-type.api","leave-absences/shared/instances/absence-type.instance"],function(e){"use strict";e.factory("AbsenceType",["$log","Model","AbsenceTypeAPI","AbsenceTypeInstance",function(e,t,n,r){return e.debug("AbsenceType"),t.extend({all:function(e){return n.all(e).then(function(e){return e.map(function(e){return r.init(e,!0)})})},calculateToilExpiryDate:function(e,t,r){return n.calculateToilExpiryDate(e,t,r)},canExpire:function(e){return n.all({accrual_expiration_unit:{"IS NOT NULL":1},accrual_expiration_duration:{"IS NOT NULL":1},allow_accruals_request:1,id:e,options:{limit:1},return:["id"]}).then(function(e){return e.length>0})}})}])}),define("contact-summary/modules/components",["common/angular"],function(e){"use strict";return e.module("contactsummary.components",[])}),define("contact-summary/components/leave-widget/leave-widget.component",["leave-absences/shared/models/absence-type.model","contact-summary/modules/components"],function(e,t){function n(e){e.debug("Controller: leaveWidgetController")}console.log("....",e),t.component("leaveWidget",{controller:n,controllerAs:"leaveWidget",templateUrl:["settings",function(e){return e.pathBaseUrl+e.pathTpl+"components/leave-widget/leave-widget.html"}]}),n.$inject=["$log"]}),define("contact-summary/modules/directives",["common/angular"],function(e){"use strict";return e.module("contactsummary.directives",[])}),define("contact-summary/directives/donutChart",["common/d3","contact-summary/modules/directives"],function(e,t){"use strict";function n(e){this.height=this.width=e[0].clientWidth,this.radius=this.width/2||60,this.thickness=this.thickness||15}function r(){return e.svg.arc().innerRadius(this.radius-this.thickness).outerRadius(this.radius)}function s(t,n,r){var s=e.scale.category20();return t.selectAll("path").data(r).enter().append("path").attr("fill",function(e,t){return s(t)}).attr("class",function(e,t){return"chart-color-"+t}).attr("d",n)}function a(){var t=e.layout.pie().sort(null).value(function(e){return e.value[this.itemKey]}.bind(this));return t(e.entries(this.items))}function c(t){return e.select(t).append("svg").attr("width",this.width).attr("height",this.height).append("g").attr("transform","translate("+this.width/2+","+this.height/2+")")}t.directive("csDonutChart",["$log",function(e){return e.debug("Directive: csDonutChart"),{controllerAs:"CsDonutChartCtrl",restrict:"AE",scope:{radius:"@",thickness:"@",items:"=",itemKey:"@",ready:"="},controller:["$scope","$element",function(e,t){this.drawChart=function(){n.call(angular.extend(this,e),t),s(c.call(this,t[0]),r.call(this),a.call(this))}}],link:function(e,t,n,r){var s=e.$watch(function(){return e.ready},function(e,t){e===!0&&(r.drawChart(),s())})}}}])}),define("contact-summary/app",["common/angular","contact-summary/modules/filters","contact-summary/modules/services","contact-summary/modules/settings","contact-summary/controllers/contactSummary","contact-summary/controllers/keyDates","contact-summary/controllers/keyDetails","contact-summary/components/leave-widget/leave-widget.component","contact-summary/directives/donutChart"],function(e){var t=e.module("contactsummary",["ngRoute","ngResource","ui.bootstrap","common.services","contactsummary.controllers","contactsummary.components","contactsummary.directives","contactsummary.filters","contactsummary.services","contactsummary.settings"]);t.config(["settings","$routeProvider","$resourceProvider","$httpProvider","$logProvider",function(e,t,n,r,s){s.debugEnabled(e.debug),t.when("/",{controller:"ContactSummaryCtrl",controllerAs:"ContactSummaryCtrl",templateUrl:e.pathBaseUrl+e.pathTpl+"mainTemplate.html",resolve:{}}).otherwise({redirectTo:"/"}),n.defaults.stripTrailingSlashes=!1,r.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]),t.run(["settings","$rootScope","$q","$log",function(e,t,n,r){r.debug("app.run"),t.pathTpl=e.pathTpl,t.prefix=e.classNamePrefix}])}),function(e,t){t.config({urlArgs:"bust="+(new Date).getTime(),paths:{"contact-summary":e.vars.contactsummary.baseURL+"/js/src/contact-summary"}}),t(["contact-summary/app"],function(){document.dispatchEvent("function"==typeof window.CustomEvent?new CustomEvent("contactsummaryReady"):function(){var e=document.createEvent("Event");return e.initEvent("contactsummaryReady",!0,!0),e}())})}(CRM,require);