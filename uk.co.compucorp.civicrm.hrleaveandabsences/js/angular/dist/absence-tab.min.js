!function(e){define("leave-absences/shared/config",[],function(){var n=CRM.vars.leaveAndAbsences.baseURL+"/js/angular/src/leave-absences/shared";e.config({paths:{"leave-absences/shared/ui-router":"leave-absences/shared/vendor/angular-ui-router.min"},shim:{"leave-absences/shared/ui-router":{}}}),e.config({paths:{"leave-absences/shared/ui-router":n+"/vendor/angular-ui-router.min"}})})}(require),function(e){define("leave-absences/absence-tab/modules/settings",["common/angular"],function(n){return n.module("absence-tab.settings",[]).constant("settings",{contactId:e.vars.leaveAndAbsences.contactId,debug:e.debug,pathTpl:e.vars.leaveAndAbsences.baseURL+"/views/absence-tab/"})})}(CRM),function(e){define("leave-absences/absence-tab/modules/config",["common/angular","leave-absences/absence-tab/modules/settings"],function(e){return e.module("absence-tab.config",["absence-tab.settings"]).config(["$resourceProvider","$httpProvider","$logProvider","settings",function(e,n,t,a){t.debugEnabled(a.debug),e.defaults.stripTrailingSlashes=!1,n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}])})}(CRM),define("leave-absences/absence-tab/modules/components",["common/angular"],function(e){return e.module("absence-tab.components",[])}),define("leave-absences/absence-tab/components/absence-tab-container",["leave-absences/absence-tab/modules/components"],function(e){e.component("absenceTabContainer",{bindings:{contactId:"<"},templateUrl:["settings",function(e){return e.pathTpl+"components/absence-tab-container.html"}],controllerAs:"absence",controller:["$log","$rootScope",function(e,n){e.debug("Component: absence-tab-container"),n.role="admin";var t={};return t}]})}),define("leave-absences/absence-tab/components/absence-tab-report",["leave-absences/absence-tab/modules/components"],function(e){function n(e){e.debug("Component: absence-tab-report");var n={};return n}e.component("absenceTabReport",{bindings:{contactId:"<"},templateUrl:["settings",function(e){return e.pathTpl+"components/absence-tab-report.html"}],controllerAs:"report",controller:["$log",n]})}),define("leave-absences/absence-tab/components/absence-tab-entitlements",["leave-absences/absence-tab/modules/components"],function(e){function n(e){e.debug("Component: absence-tab-entitlements");var n={};return n.contactId=this.contactId,n}e.component("absenceTabEntitlements",{bindings:{contactId:"<"},templateUrl:["settings",function(e){return e.pathTpl+"components/absence-tab-entitlements.html"}],controllerAs:"entitlements",controller:["$log",n]})}),define("leave-absences/absence-tab/components/absence-tab-work-patterns",["leave-absences/absence-tab/modules/components"],function(e){function n(e,n,t,a){e.debug("Component: absence-tab-work-patterns");var s={};return s.openModal=function(){t.open({appendTo:n.children().eq(0),templateUrl:a.pathTpl+"components/absence-tab-custom-work-pattern-modal.html"})},s}e.component("absenceTabWorkPatterns",{bindings:{contactId:"<"},templateUrl:["settings",function(e){return e.pathTpl+"components/absence-tab-work-patterns.html"}],controllerAs:"workpatterns",controller:["$log","$rootElement","$uibModal","settings",n]})}),define("leave-absences/absence-tab/components/contract-entitlements",["common/lodash","common/moment","leave-absences/absence-tab/modules/components","common/models/contract"],function(e,n,t){function a(t,a,s,o,c,r){function i(e){var t=s.DATE_FORMAT.toUpperCase();return e?n(e).format(t):""}function l(){return o.all().then(function(e){m.absenceTypes=e})}function d(){return c.all({contact_id:m.contactId}).then(function(e){u(e)})}function u(t){m.contracts=e.sortBy(t,function(e){return n(e.info.details.period_start_date)}).map(function(n){var t=n.info,a=t.details,s=e.map(m.absenceTypes,function(n){var a=e.filter(t.leave,function(e){return e.leave_type===n.id})[0];return{amount:a?a.leave_amount:""}});return{position:a.position,start_date:i(a.period_start_date),end_date:i(a.period_end_date),absences:s}}),m.loaded.contracts=!0}t.debug("Component: contract-entitlements");var m={};return m.absenceTypes=[],m.contactId=this.contactId,m.contracts=[],m.loaded={contracts:!1},function(){return a.all([l(),r.getDateFormat()]).then(function(){return d()})}(),m}t.component("contractEntitlements",{bindings:{contactId:"<"},templateUrl:["settings",function(e){return e.pathTpl+"components/contract-entitlements.html"}],controllerAs:"entitlements",controller:["$log","$q","HR_settings","AbsenceType","Contract","DateFormat",a]})}),define("leave-absences/shared/modules/components",["common/angular"],function(e){return e.module("leave-absences.components",[])}),function(e){define("leave-absences/shared/modules/shared-settings",["common/angular"],function(n){return n.module("leave-absences.settings",[]).constant("shared-settings",{attachmentToken:e.vars.leaveAndAbsences.attachmentToken,debug:e.debug,managerPathTpl:e.vars.leaveAndAbsences.baseURL+"/views/manager-leave/",sharedPathTpl:e.vars.leaveAndAbsences.baseURL+"/views/shared/",serverDateFormat:"YYYY-MM-DD",serverDateTimeFormat:"YYYY-MM-DD HH:mm:ss",permissions:{admin:{access:"access leave and absences",administer:"administer leave and absences"},ssp:{access:"access leave and absences in ssp",manage:"manage leave and absences in ssp"}},fileUploader:{queueLimit:10,allowedMimeTypes:{txt:"plain",png:"png",jpeg:"jpeg",bmp:"bmp",gif:"gif",pdf:"pdf",doc:"msword",docx:"vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"vnd.ms-excel",xlsx:"vnd.openxmlformats-officedocument.spreadsheetml.sheet",ppt:"vnd.ms-powerpoint",pptx:"vnd.openxmlformats-officedocument.presentationml.presentation"}},statusNames:{approved:"approved",adminApproved:"admin_approved",awaitingApproval:"awaiting_approval",moreInformationRequired:"more_information_required",rejected:"rejected",cancelled:"cancelled"}})})}(CRM),define("leave-absences/shared/modules/apis",["common/angular","common/modules/apis","leave-absences/shared/modules/shared-settings"],function(e){"use strict";return e.module("leave-absences.apis",["common.apis","leave-absences.settings"])}),define("leave-absences/shared/modules/models-instances",["common/angular","common/models/instances/instance","common/modules/services","leave-absences/shared/modules/shared-settings"],function(e){"use strict";return e.module("leave-absences.models.instances",["common.models.instances","common.services","leave-absences.settings"])}),define("leave-absences/shared/modules/models",["common/angular","common/modules/models","common/modules/services","leave-absences/shared/modules/apis","leave-absences/shared/modules/models-instances","leave-absences/shared/modules/shared-settings"],function(e){"use strict";return e.module("leave-absences.models",["common.models","common.services","leave-absences.apis","leave-absences.models.instances","leave-absences.settings"])}),define("leave-absences/shared/modules/controllers",["common/angular","common/angularBootstrap","leave-absences/shared/modules/models","leave-absences/shared/modules/models-instances","leave-absences/shared/modules/shared-settings"],function(e){return e.module("leave-absences.controllers",["ui.select","leave-absences.models","leave-absences.models.instances","leave-absences.settings"])}),define("leave-absences/shared/models/instances/absence-period-instance",["leave-absences/shared/modules/models-instances","common/moment","common/models/instances/instance","common/services/hr-settings"],function(e,n){"use strict";e.factory("AbsencePeriodInstance",["$log","ModelInstance","HR_settings",function(e,t,a){return e.debug("AbsencePeriodInstance"),t.extend({defaultCustomData:function(){return{current:!1}},transformAttributes:function(e){var t=n();return e.current=!1,n(e.start_date).isSameOrBefore(t,"day")&&n(e.end_date).isSameOrAfter(t,"day")&&(e.current=!0),e},isInPeriod:function(e){var t=a.DATE_FORMAT.toUpperCase(),s=n(e,t);return n(this.start_date).isSameOrBefore(s)&&n(this.end_date).isSameOrAfter(s)}})}])}),define("leave-absences/shared/apis/absence-period-api",["leave-absences/shared/modules/apis","common/services/api"],function(e){"use strict";e.factory("AbsencePeriodAPI",["$log","api",function(e,n){return e.debug("AbsencePeriodAPI"),n.extend({all:function(n){return e.debug("AbsencePeriodAPI"),this.sendGET("AbsencePeriod","get",n).then(function(e){return e.values})}})}])}),define("leave-absences/shared/models/absence-period-model",["leave-absences/shared/modules/models","common/moment","leave-absences/shared/modules/shared-settings","leave-absences/shared/models/instances/absence-period-instance","leave-absences/shared/apis/absence-period-api","common/models/model","common/services/hr-settings"],function(e,n){"use strict";e.factory("AbsencePeriod",["$log","Model","AbsencePeriodAPI","AbsencePeriodInstance","shared-settings",function(e,t,a,s,o){return e.debug("AbsencePeriod"),t.extend({all:function(e){return a.all(e).then(function(e){return e.map(function(e){return s.init(e,!0)})})},current:function(){var e=n().format(o.serverDateFormat),t={start_date:{"<=":e},end_date:{">=":e}};return a.all(t).then(function(e){return e&&e.length?s.init(e[0],!0):null})}})}])}),define("leave-absences/shared/models/instances/absence-type-instance",["leave-absences/shared/modules/models-instances","common/models/instances/instance"],function(e){"use strict";e.factory("AbsenceTypeInstance",["$log","ModelInstance",function(e,n){return e.debug("AbsenceTypeInstance"),n.extend({})}])}),define("leave-absences/shared/apis/absence-type-api",["common/lodash","common/moment","leave-absences/shared/modules/apis","common/services/api"],function(e,n,t){"use strict";t.factory("AbsenceTypeAPI",["$log","api","shared-settings",function(t,a,s){return t.debug("AbsenceTypeAPI"),a.extend({all:function(n){return t.debug("AbsenceTypeAPI.all"),this.sendGET("AbsenceType","get",e.defaults(n||{},{is_active:!0})).then(function(e){return e.values})},calculateToilExpiryDate:function(a,o,c){return t.debug("AbsenceTypeAPI.calculateToilExpiryDate"),c=e.assign({},c,{absence_type_id:a,date:n(o).format(s.serverDateFormat)}),this.sendPOST("AbsenceType","calculateToilExpiryDate",c).then(function(e){return e.values.expiry_date})}})}])}),define("leave-absences/shared/models/absence-type-model",["leave-absences/shared/modules/models","leave-absences/shared/models/instances/absence-type-instance","leave-absences/shared/apis/absence-type-api","common/models/model"],function(e){"use strict";e.factory("AbsenceType",["$log","Model","AbsenceTypeAPI","AbsenceTypeInstance",function(e,n,t,a){return e.debug("AbsenceType"),n.extend({all:function(e){return t.all(e).then(function(e){return e.map(function(e){return a.init(e,!0)})})},calculateToilExpiryDate:function(e,n,a){return t.calculateToilExpiryDate(e,n,a)}})}])}),define("leave-absences/shared/models/instances/public-holiday-instance",["leave-absences/shared/modules/models-instances","common/models/instances/instance"],function(e){"use strict";e.factory("PublicHolidayInstance",["$log","ModelInstance",function(e,n){return e.debug("PublicHolidayInstance"),n.extend({})}])}),define("leave-absences/shared/apis/public-holiday-api",["leave-absences/shared/modules/apis","common/services/api"],function(e){"use strict";e.factory("PublicHolidayAPI",["$log","api",function(e,n){return e.debug("PublicHolidayAPI"),n.extend({all:function(n){return e.debug("PublicHolidayAPI"),this.sendGET("PublicHoliday","get",n).then(function(e){return e.values})}})}])}),define("leave-absences/shared/models/public-holiday-model",["leave-absences/shared/modules/models","common/moment","leave-absences/shared/models/instances/public-holiday-instance","leave-absences/shared/apis/public-holiday-api","common/models/model","common/services/hr-settings"],function(e,n){"use strict";e.factory("PublicHoliday",["$log","Model","PublicHolidayAPI","PublicHolidayInstance","shared-settings",function(e,t,a,s,o){return e.debug("PublicHoliday"),t.extend({all:function(n){return e.debug("PublicHoliday.all",n),a.all(n).then(function(e){return e.map(function(e){return s.init(e,!0)})})},isPublicHoliday:function(t){e.debug("PublicHoliday.isPublicHoliday",t);var s=n(t).format(o.serverDateFormat),c={date:s};return a.all(c).then(function(e){return!!e.length})}})}])}),define("leave-absences/shared/controllers/calendar-ctrl",["leave-absences/shared/modules/controllers","common/lodash","common/moment","leave-absences/shared/models/absence-period-model","leave-absences/shared/models/absence-type-model","leave-absences/shared/models/public-holiday-model"],function(e,n,t){"use strict";function a(e,a,s,o,c,r,i,l){function d(e){var t=n.find(m,function(n){return n.name===e});return!!t&&t.value}var u=[],m=[],b=[];return this.absencePeriods=[],this.absenceTypes=[],this.leaveRequests={},this.months=[],this.monthLabels=t.monthsShort(),this.selectedMonths=[],this.selectedPeriod=null,this.loading={calendar:!1,page:!1},this.changeSelectedPeriod=function(){this._fetchMonthsFromPeriod(),this.refresh()},this.getAbsenceTypeStyle=function(e){return{backgroundColor:e.color,borderColor:e.color}},this.getDayName=function(e){return this._getDateObjectWithFormat(e).format("ddd")},this.isPublicHoliday=function(e){return!!b[this._getDateObjectWithFormat(e).valueOf()]},this.labelPeriod=function(e){return e.current?"Current Period ("+e.title+")":e.title},this._fetchMonthsFromPeriod=function(){for(var e=[],n=t(this.selectedPeriod.start_date),a=t(this.selectedPeriod.end_date);n.isBefore(a);)e.push(this._getMonthSkeleton(n)),n.add(1,"month");this.months=e},this._getDateObjectWithFormat=function(e){return t(e,s.serverDateFormat)},this._getMonthObjectByDate=function(e,t){return n.find(t,function(n){return n.month===e.month()&&n.year===e.year()})},this._getStyles=function(e,t){var a;return t.leaveRequest=e,a=n.find(this.absenceTypes,function(n){return n.id===e.type_id}),e.balance_change>0?(t.UI.isAccruedTOIL=!0,{borderColor:a.color}):{backgroundColor:a.color,borderColor:a.color}},this._init=function(n){this.loading.page=!0,this.selectedMonths=[this.monthLabels[t().month()]],e.all([this._loadAbsencePeriods(),this._loadAbsenceTypes(),this._loadPublicHolidays(),this._loadStatuses(),this._loadDayTypes()]).then(function(){return n?n():null}).then(function(){return this.legendCollapsed=!1,this._loadLeaveRequestsAndCalendar()}.bind(this)).finally(function(){this.loading.page=!1}.bind(this))},this._isDayType=function(e,n,a){var s=u[e];return t(a).isSame(n.from_date)?s.value===n.from_date_type:t(a).isSame(n.to_date)?s.value===n.to_date_type:void 0},this._isPendingApproval=function(e){var n=m[e.status_id];return n.name===s.statusNames.awaitingApproval},this._loadAbsencePeriods=function(){return o.all().then(function(e){this.absencePeriods=n.sortBy(e,"start_date"),this.selectedPeriod=n.find(this.absencePeriods,function(e){return!!e.current}),this._fetchMonthsFromPeriod()}.bind(this))},this._loadAbsenceTypes=function(){return c.all({is_active:!0}).then(function(e){this.absenceTypes=e}.bind(this))},this._loadDayTypes=function(){return l.valuesOf("hrleaveandabsences_leave_request_day_type").then(function(e){u=n.indexBy(e,"name")})},this._loadLeaveRequestsAndCalendar=function(e,n,t){n=void 0===n||n;var a={from_date:{from:this.selectedPeriod.start_date},to_date:{to:this.selectedPeriod.end_date},status_id:{IN:[d(s.statusNames.approved),d(s.statusNames.adminApproved),d(s.statusNames.awaitingApproval)]}};return a[e]=this.contactId,r.all(a,{},null,null,n).then(function(e){return this._indexLeaveRequests(e.list),this._loadCalendar()}.bind(this)).then(function(){t&&t(),this.loading.calendar=!1,this._showMonthLoader()}.bind(this))},this._loadPublicHolidays=function(){return i.all().then(function(e){b=n.transform(e,function(e,n){e[this._getDateObjectWithFormat(n.date).valueOf()]=n}.bind(this),{})}.bind(this))},this._loadStatuses=function(){return l.valuesOf("hrleaveandabsences_leave_request_status").then(function(e){m=n.indexBy(e,"value")})},this._resetMonths=function(){n.each(this.months,function(e){e.data=[]})},this._showMonthLoader=function(){var e=500,n=0;this.months.forEach(function(t){t.loading=t.label!==this.selectedMonths[0],t.loading&&(a(function(){t.loading=!1},n),n+=e)}.bind(this))},this}e.controller("CalendarCtrl",["$q","$timeout","shared-settings","AbsencePeriod","AbsenceType","LeaveRequest","PublicHoliday","OptionGroup",a])}),define("leave-absences/shared/components/staff-leave-calendar",["common/lodash","common/moment","leave-absences/shared/modules/components","leave-absences/shared/controllers/calendar-ctrl"],function(e,n,t){function a(t,a,s,o){a.debug("Component: staff-leave-calendar");var c=t("CalendarCtrl"),r=Object.create(c);return r.getMonthData=function(n){var t;return t=e.find(r.months,function(e){return e.month===n.month&&e.year===n.year}),t?t.data:[]},r.refresh=function(){r.loading.calendar=!0,r._resetMonths(),r._loadLeaveRequestsAndCalendar()},r._getMonthSkeleton=function(e){return{month:e.month(),year:e.year(),data:[]}},r._indexLeaveRequests=function(n){r.leaveRequests={},e.each(n,function(n){e.each(n.dates,function(e){r.leaveRequests[e.date]=n})})},r._loadCalendar=function(){return o.get(r.contactId,r.selectedPeriod.id).then(function(e){r._setCalendarProps(e)})},r._loadLeaveRequestsAndCalendar=function(){return c._loadLeaveRequestsAndCalendar.call(r,"contact_id",!1)},r._setCalendarProps=function(t){var a,s=e.clone(r.months);e.each(t.days,function(e){a=r.leaveRequests[e.date],e.UI={isWeekend:t.isWeekend(r._getDateObjectWithFormat(e.date)),isNonWorkingDay:t.isNonWorkingDay(r._getDateObjectWithFormat(e.date)),isPublicHoliday:r.isPublicHoliday(e.date)},a&&(e.UI.styles=r._getStyles(a,e),e.UI.isRequested=r._isPendingApproval(a),e.UI.isAM=r._isDayType("half_day_am",a,e.date),e.UI.isPM=r._isDayType("half_day_pm",a,e.date)),r._getMonthObjectByDate(n(e.date),s).data.push(e)}),r.months=s},function(){r._init(),s.$on("LeaveRequest::new",r.refresh),s.$on("LeaveRequest::edit",r.refresh)}(),r}t.component("staffLeaveCalendar",{bindings:{contactId:"<"},templateUrl:["shared-settings",function(e){return e.sharedPathTpl+"components/staff-leave-calendar.html"}],controllerAs:"calendar",controller:["$controller","$log","$rootScope","Calendar",a]})}),define("leave-absences/shared/models/instances/calendar-instance",["common/lodash","common/moment","leave-absences/shared/modules/models-instances","common/models/instances/instance"],function(e,n,t){"use strict";t.factory("CalendarInstance",["$log","ModelInstance","shared-settings",function(t,a,s){function o(e,n){var t=this.days[c(e).valueOf()];return!!t&&t.type.name===n}function c(e){return n(e,s.serverDateFormat).clone()}return a.extend({transformAttributes:function(n){var t={};return n.calendar.forEach(function(e){t[c(e.date).valueOf()]=e}),e(n).omit("calendar").assign({days:t}).value()},defaultCustomData:function(){return{days:[]}},isWorkingDay:function(e){return o.call(this,e,"working_day")},isNonWorkingDay:function(e){return o.call(this,e,"non_working_day")},isWeekend:function(e){return o.call(this,e,"weekend")}})}])}),define("leave-absences/shared/apis/work-pattern-api",["common/lodash","leave-absences/shared/modules/apis","common/services/api"],function(e,n){"use strict";n.factory("WorkPatternAPI",["$log","api",function(n,t){return n.debug("WorkPatternAPI"),t.extend({getCalendar:function(t,a,s){return n.debug("WorkPatternAPI.getCalendar",t,a,s),this.sendGET("WorkPattern","getcalendar",e.assign({},s,{contact_id:e.isArray(t)?{IN:t}:t,period_id:a}))}})}])}),define("leave-absences/shared/models/calendar-model",["common/lodash","leave-absences/shared/modules/models","leave-absences/shared/models/instances/calendar-instance","leave-absences/shared/apis/work-pattern-api","common/models/model"],function(e,n){"use strict";n.factory("Calendar",["$log","Model","WorkPatternAPI","CalendarInstance",function(n,t,a,s){return n.debug("Calendar"),t.extend({get:function(t,o,c){return n.debug("Calendar.get"),a.getCalendar(t,o,c).then(function(n){var a=n.values.map(function(e){return s.init(e)});return e.isArray(t)?a:a[0]})}})}])}),define("leave-absences/shared/models/instances/leave-request-instance",["common/lodash","leave-absences/shared/modules/models-instances","common/models/option-group","common/models/instances/instance","common/services/file-upload"],function(e,n){"use strict";n.factory("LeaveRequestInstance",["$q","OptionGroup","FileUpload","shared-settings","ModelInstance","LeaveRequestAPI",function(n,t,a,s,o,c){function r(e){return d(e).then(function(e){return this.status_id=e.value,this.update()}.bind(this))}function i(e){return d(e).then(function(e){return this.status_id===e.value}.bind(this))}function l(){var t=[];return e.forEach(this.files,function(e){e.toBeDeleted&&t.push(c.deleteAttachment(this.id,e.attachment_id))}.bind(this)),n.all(t)}function d(e){return t.valuesOf("hrleaveandabsences_leave_request_status").then(function(n){return n.find(function(n){return n.name===e})})}function u(){var e=[],t=this;return t.comments.map(function(n,a){n.comment_id?n.toBeDeleted&&e.push(c.deleteComment(n.comment_id)):!function(a){e.push(c.saveComment(t.id,n).then(function(e){t.comments[a]=e}))}(a)}),n.all(e)}function m(){return this.fileUploader.queue&&this.fileUploader.queue.length>0?this.fileUploader.uploadAll({entityID:this.id}):n.resolve([])}return o.extend({defaultCustomData:function(){return{comments:[],files:[],request_type:"leave",fileUploader:a.uploader({entityTable:"civicrm_hrleaveandabsences_leave_request",crmAttachmentToken:s.attachmentToken,queueLimit:s.fileUploader.queueLimit,allowedMimeTypes:s.fileUploader.allowedMimeTypes})}},cancel:function(){return r.call(this,s.statusNames.cancelled)},approve:function(){return r.call(this,s.statusNames.approved)},reject:function(){return r.call(this,s.statusNames.rejected)},sendBack:function(){return r.call(this,s.statusNames.moreInformationRequired)},update:function(){return c.update(this.toAPI()).then(function(){return n.all([u.call(this),m.call(this),l.call(this)])}.bind(this))},create:function(){return c.create(this.toAPI()).then(function(e){return this.id=e.id,n.all([u.call(this),m.call(this)])}.bind(this))},deleteAttachment:function(e){e.toBeDeleted||(e.toBeDeleted=!0)},deleteComment:function(n){return n.comment_id?void(n.toBeDeleted=!0):void(this.comments=e.reject(this.comments,function(e){return n.created_at===e.created_at&&n.text===e.text}))},delete:function(){return c.delete(this.id)},isValid:function(){return c.isValid(this.toAPI())},isApproved:function(){return i.call(this,s.statusNames.approved)},isAwaitingApproval:function(){return i.call(this,s.statusNames.awaitingApproval)},isCancelled:function(){return i.call(this,s.statusNames.cancelled)},isRejected:function(){return i.call(this,s.statusNames.rejected)},isSentBack:function(){return i.call(this,s.statusNames.moreInformationRequired)},loadComments:function(){return this.id?c.getComments(this.id).then(function(e){this.comments=e}.bind(this)):n.resolve()},toAPIFilter:function(n,t,a){e.includes(["balance_change","dates","comments","fileUploader","files"],a)||(n[a]=this[a])},loadAttachments:function(){return this.id?c.getAttachments(this.id).then(function(e){this.files=e}.bind(this)):n.resolve()}})}])}),define("leave-absences/shared/apis/leave-request-api",["leave-absences/shared/modules/apis","common/lodash","common/services/api"],function(e,n){"use strict";e.factory("LeaveRequestAPI",["$log","api","$q","shared-settings",function(e,t,a){return e.debug("LeaveRequestAPI"),t.extend({all:function(n,t,s,o,c){e.debug("LeaveRequestAPI.all");var r=a.defer();return n&&n.contact_id&&n.contact_id.IN&&0===n.contact_id.IN.length?r.resolve({list:[],total:0,allIds:[]}):r.resolve(this.getAll("LeaveRequest",n,t,s,o,"getFull",c)),r.promise},balanceChangeByAbsenceType:function(n,t,s,o){e.debug("LeaveRequestAPI.balanceChangeByAbsenceType");var c=a.defer();n&&t||c.reject("contact_id and period_id are mandatory");var r={contact_id:n,period_id:t,statuses:s?{IN:s}:null,public_holiday:o||!1};return this.sendGET("LeaveRequest","getbalancechangebyabsencetype",r,!1).then(function(e){c.resolve(e.values)}),c.promise},calculateBalanceChange:function(n){e.debug("LeaveRequestAPI.calculateBalanceChange",n);var t=a.defer();return!n||n.contact_id&&n.from_date&&n.from_date_type||t.reject("contact_id, from_date and from_date_type in params are mandatory"),this.sendPOST("LeaveRequest","calculatebalancechange",n).then(function(e){t.resolve(e.values)}),t.promise},create:function(n){e.debug("LeaveRequestAPI.create",n);var t=a.defer();return n&&(n.to_date&&!n.to_date_type?t.reject("to_date_type is mandatory"):n.contact_id&&n.from_date&&n.from_date_type&&n.status_id||t.reject("contact_id, from_date, status_id and from_date_type params are mandatory")),this.sendPOST("LeaveRequest","create",n).then(function(e){t.resolve(e.values[0])}),t.promise},delete:function(e){return this.sendGET("LeaveRequest","delete",{id:e})},deleteAttachment:function(e,t,a){return a=n.assign({},a,{leave_request_id:e,attachment_id:t}),this.sendPOST("LeaveRequest","deleteattachment",a).then(function(e){return e.values})},deleteComment:function(e,t){return t=n.assign({},t,{comment_id:e}),this.sendPOST("LeaveRequest","deletecomment",t).then(function(e){return e.values})},getAttachments:function(e,t){return t=n.assign({},t,{leave_request_id:e}),this.sendGET("LeaveRequest","getattachments",t,!1).then(function(e){return e.values})},getComments:function(e,t){return t=n.assign({},t,{leave_request_id:e}),this.sendGET("LeaveRequest","getcomment",t,!1).then(function(e){return e.values})},isValid:function(t){e.debug("LeaveRequestAPI.isValid",t);var s=a.defer();return this.sendPOST("LeaveRequest","isValid",t).then(function(e){e.count>0?s.reject(n(e.values).map().flatten().value()):s.resolve(e.values)}),s.promise},saveComment:function(e,t,a){return a=n.assign({},a,{leave_request_id:e,text:t.text,contact_id:t.contact_id,created_at:t.created_at}),this.sendPOST("LeaveRequest","addcomment",a).then(function(e){return e.values})},update:function(n){e.debug("LeaveRequestAPI.update",n);var t=a.defer();return n.id||t.reject("id is mandatory field"),this.sendPOST("LeaveRequest","create",n).then(function(e){t.resolve(e.values[0])}),t.promise}})}])}),define("leave-absences/shared/models/leave-request-model",["leave-absences/shared/modules/models","leave-absences/shared/models/instances/leave-request-instance","leave-absences/shared/apis/leave-request-api","common/models/model"],function(e){"use strict";e.factory("LeaveRequest",["$log","Model","LeaveRequestAPI","LeaveRequestInstance",function(e,n,t,a){return e.debug("LeaveRequest"),n.extend({all:function(e,n,s,o,c){return t.all(this.processFilters(e),n,s,o,c).then(function(e){return e.list=e.list.map(function(e){return a.init(e,!0)}),e})},balanceChangeByAbsenceType:function(e,n,a,s){return t.balanceChangeByAbsenceType(e,n,a,s)},calculateBalanceChange:function(n){return e.debug("LeaveRequestAPI.calculateBalanceChange"),t.calculateBalanceChange(n)}})}])}),define("leave-absences/absence-tab/app",["common/angular","common/angularBootstrap","common/modules/directives","common/services/angular-date/date-format","leave-absences/absence-tab/modules/config","leave-absences/absence-tab/components/absence-tab-container","leave-absences/absence-tab/components/absence-tab-report","leave-absences/absence-tab/components/absence-tab-entitlements","leave-absences/absence-tab/components/absence-tab-work-patterns","leave-absences/absence-tab/components/contract-entitlements","leave-absences/shared/components/staff-leave-calendar","leave-absences/shared/models/calendar-model","leave-absences/shared/models/leave-request-model","leave-absences/shared/modules/shared-settings","leave-absences/shared/models/absence-type-model"],function(e){return e.module("absence-tab",["ngResource","ui.bootstrap","common.angularDate","common.directives","absence-tab.config","absence-tab.components","leave-absences.components","leave-absences.controllers","leave-absences.models","leave-absences.settings"]).run(["$log","$rootScope","shared-settings","settings",function(e,n,t,a){e.debug("app.run"),n.sharedPathTpl=t.sharedPathTpl,n.settings=a}]),e}),function(e,n){var t=e.vars.leaveAndAbsences.baseURL+"/js/angular/src/leave-absences";n.config({urlArgs:"bust="+(new Date).getTime(),paths:{"leave-absences/shared":t+"/shared","leave-absences/absence-tab":t+"/absence-tab"}}),n(["leave-absences/shared/config"],function(){n(["leave-absences/absence-tab/app"],function(){document.dispatchEvent("function"==typeof window.CustomEvent?new CustomEvent("absenceTabReady"):function(){var e=document.createEvent("Event");return e.initEvent("absenceTabReady",!0,!0),e}())})})}(CRM,require),define("absence-tab",function(){});