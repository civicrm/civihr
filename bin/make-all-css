#!/bin/bash

## DESCRIPTION: Run "gulp sass" in every extension
##
## MIGRATION UTILITY: Delete this script after the bootstrap materials are migrated to their own repos.

set -ex

if [ ! -d uk.co.compucorp.civicrm.appraisals ]; then
  echo "Please execute this from within the civihr folder." 1>&2
  exit 1
fi

echo "[[ Pre-clean ]]"
cv path \
  -x org.civicrm.shoreditch/css/bootstrap.css \
  -x org.civicrm.shoreditch/css/custom-civicrm.css \
  -x org.civicrm.bootstrapcivihr/css/civihr.css \
  -x contactsummary/css/contactsummary.css \
  -x uk.co.compucorp.civicrm.appraisals/css/civiappraisals.css \
  -x org.civicrm.styleguide/css/styleguide.css \
| while read f ; do 
  if [ -f "$f" ]; then rm -f "$f" ; fi
done
echo "[[ Pre-clean status ]]"
git status

echo "[[ Build ]]"

for EXT in contactsummary contactaccessrights org.civicrm.shoreditch org.civicrm.bootstrapcivihr uk.co.compucorp.civicrm.appraisals org.civicrm.styleguide ; do
  pushd `cv path -x $EXT`
    [ ! -d node_modules ] && npm install
    time gulp sass
  popd
done

echo "[[ Final status ]]"
git status
